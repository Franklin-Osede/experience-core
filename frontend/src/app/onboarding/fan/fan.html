<div class="relative min-h-screen flex flex-col max-w-md mx-auto w-full pb-8 bg-background-light dark:bg-background-dark">
  <!-- Header / Progress -->
  <header class="flex w-full flex-col items-center justify-center pt-8 px-6">
    <div class="flex items-center justify-between w-full mb-4">
        <button 
          (click)="goBack()"
          class="flex items-center justify-center size-10 rounded-full hover:bg-black/5 dark:hover:bg-white/5 transition-colors text-slate-900/80 dark:text-white/80 hover:text-slate-900 dark:hover:text-white">
          <span class="material-symbols-outlined" style="font-size: 24px;">arrow_back_ios_new</span>
        </button>
        <div class="flex-1"></div> <!-- Spacer -->
    </div>
    <div class="flex w-full flex-row items-center justify-center gap-3">
        <div class="h-1.5 w-8 rounded-full bg-primary transition-all duration-300 shadow-[0_0_10px_rgba(244,140,37,0.5)]"></div>
        <div class="h-1.5 w-2 rounded-full bg-white/10 dark:bg-white/20"></div>
    </div>
  </header>

  <!-- Main Content Scrollable Area -->
  <main class="flex-grow flex flex-col px-6">
    <!-- Headline Section -->
    <div class="flex flex-col gap-2 mb-6 pt-4">
      <h1 class="text-3xl font-bold tracking-tight leading-tight text-slate-900 dark:text-white">
        Curate Your Night
      </h1>
      <p class="text-base text-slate-500 dark:text-gray-400 font-normal leading-relaxed">
        Select the sounds that move you to tailor your event recommendations.
      </p>
    </div>

    <!-- Taste Selectors -->
    <div class="grid grid-cols-2 gap-4 mb-10">
      @for (genre of genres; track genre.name) {
        <!-- State Card -->
        <div 
          (click)="toggleGenre(genre.name)"
          class="group relative aspect-[3/4] cursor-pointer w-full transition-all duration-300"
          [class.active:scale-95]="!isGenreSelected(genre.name)">
          
          <!-- Active Glow/Border Effect (Only visible when selected) -->
          @if (isGenreSelected(genre.name)) {
            <div class="absolute -inset-0.5 bg-gradient-to-b from-primary to-primary/50 rounded-2xl opacity-100 blur-[2px]"></div>
          }

          <div class="relative h-full w-full rounded-2xl overflow-hidden bg-surface-dark transition-all"
               [class.border-2]="isGenreSelected(genre.name)"
               [class.border-primary]="isGenreSelected(genre.name)"
               [class.shadow-lg]="isGenreSelected(genre.name)"
               [class.shadow-primary/20]="isGenreSelected(genre.name)"
               [class.border]="!isGenreSelected(genre.name)"
               [class.border-white/5]="!isGenreSelected(genre.name)"
               [class.opacity-60]="!isGenreSelected(genre.name)"
               [class.hover:opacity-100]="!isGenreSelected(genre.name)">
            
            <!-- Image -->
            <div class="absolute inset-0 bg-cover bg-center transition-all duration-700 group-hover:scale-105"
                 [class.grayscale-50]="!isGenreSelected(genre.name)"
                 [class.group-hover:grayscale-0]="!isGenreSelected(genre.name)"
                 [attr.data-alt]="genre.alt"
                 [style.background-image]="'linear-gradient(0deg, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0) 60%), url(' + genre.image + ')'">
            </div>

            <!-- Selected Icon -->
            @if (isGenreSelected(genre.name)) {
                <div class="absolute top-3 right-3 bg-primary text-white rounded-full p-1 shadow-md z-10 animate-in zoom-in duration-300">
                    <span class="material-symbols-outlined text-[16px] leading-none">check</span>
                </div>
            }

            <!-- Content -->
            <div class="absolute bottom-0 left-0 w-full p-4 flex flex-col gap-1">
              <h3 class="text-lg font-bold text-white leading-none">{{ genre.name }}</h3>
              @if (isGenreSelected(genre.name)) {
                <span class="text-xs text-primary font-medium tracking-wide uppercase">Selected</span>
              }
            </div>
          </div>
        </div>
      }
    </div>

    <!-- Phone Verification Section -->
    <div class="flex flex-col gap-4 mt-auto z-10">
      <div class="space-y-1">
        <h3 class="text-xl font-bold tracking-tight text-slate-900 dark:text-white">Secure your spot</h3>
        <p class="text-sm text-gray-500 dark:text-gray-400">Verify your mobile to get exclusive access.</p>
      </div>

      <!-- Custom Phone Input -->
      <div class="group relative flex items-center w-full bg-white dark:bg-[#2c241b] border border-gray-200 dark:border-white/10 rounded-full focus-within:border-primary focus-within:ring-1 focus-within:ring-primary transition-all duration-300 h-14 overflow-hidden shadow-sm">
        <!-- Country Selector Visual -->
        <button class="flex items-center gap-2 pl-5 pr-3 h-full border-r border-gray-100 dark:border-white/10 hover:bg-gray-50 dark:hover:bg-white/5 transition-colors">
          <span class="text-xl">ðŸ‡ºðŸ‡¸</span>
          <span class="text-sm font-medium text-slate-900 dark:text-white/90">+1</span>
          <span class="material-symbols-outlined text-gray-400 dark:text-white/50 text-sm">expand_more</span>
        </button>
        <!-- Input Field -->
        <input 
            class="w-full h-full bg-transparent border-none text-slate-900 dark:text-white placeholder-gray-400 dark:placeholder-white/30 px-4 focus:ring-0 text-lg font-medium tracking-wide caret-primary" 
            placeholder="(555) 000-0000" 
            type="tel"
            [value]="phoneNumber()"
            (input)="onPhoneNumberChange($event)"/>
      </div>

      <!-- Privacy Note -->
      <div class="flex items-center justify-center gap-1.5 opacity-60 mt-1 pb-4">
        <span class="material-symbols-outlined text-[14px] text-primary">lock</span>
        <p class="text-[11px] text-center text-slate-500 dark:text-white/80">Your privacy is our priority. No spam, just access.</p>
      </div>
    </div>

    <!-- CTA Button -->
    <button 
        (click)="onContinue()"
        class="mt-2 w-full bg-primary hover:bg-primary/90 text-white text-lg font-bold py-4 rounded-full shadow-[0_4px_20px_rgba(244,140,37,0.3)] transition-all transform active:scale-[0.98] flex items-center justify-center gap-2 mb-6">
      <span>Verify & Enter</span>
      <span class="material-symbols-outlined text-lg">arrow_forward</span>
    </button>
  </main>
</div>
